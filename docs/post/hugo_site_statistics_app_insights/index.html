<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="Azure Readiness starts here...">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://www.007ffflearning.com/img/home-bg-azure.jpg">
    <meta property="twitter:image" content="https://www.007ffflearning.com/img/home-bg-azure.jpg" />
    

    
    <meta name="title" content="Collecting Hugo static site statistics using Azure Application Insights" />
    <meta property="og:title" content="Collecting Hugo static site statistics using Azure Application Insights" />
    <meta property="twitter:title" content="Collecting Hugo static site statistics using Azure Application Insights" />
    

    
    <meta name="description" content="">
    <meta property="og:description" content="" />
    <meta property="twitter:description" content="" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="Azure, Learning, Certification, Technology">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>Collecting Hugo static site statistics using Azure Application Insights-Azure Readiness Starts Here</title>

    <link rel="canonical" href="/post/hugo_site_statistics_app_insights/">

    <link rel="stylesheet" href="/css/iDisqus.min.css"/>
	
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">
    
    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    
    

    
    
    <script src="/js/jquery.min.js"></script>
    
    
    <script src="/js/bootstrap.min.js"></script>
    
    
    <script src="/js/hux-blog.min.js"></script>

    
    

    <script type="text/javascript">
            var sdkInstance="appInsightsSDK";window[sdkInstance]="appInsights";var aiName=window[sdkInstance],aisdk=window[aiName]||function(e){function n(e){t[e]=function(){var n=arguments;t.queue.push(function(){t[e].apply(t,n)})}}var t={config:e};t.initialize=!0;var i=document,a=window;setTimeout(function(){var n=i.createElement("script");n.src=e.url||"https://az416426.vo.msecnd.net/scripts/b/ai.2.min.js",i.getElementsByTagName("script")[0].parentNode.appendChild(n)});try{t.cookie=i.cookie}catch(e){}t.queue=[],t.version=2;for(var r=["Event","PageView","Exception","Trace","DependencyData","Metric","PageViewPerformance"];r.length;)n("track"+r.pop());n("startTrackPage"),n("stopTrackPage");var s="Track"+r[0];if(n("start"+s),n("stop"+s),n("setAuthenticatedUserContext"),n("clearAuthenticatedUserContext"),n("flush"),!(!0===e.disableExceptionTracking||e.extensionConfig&&e.extensionConfig.ApplicationInsightsAnalytics&&!0===e.extensionConfig.ApplicationInsightsAnalytics.disableExceptionTracking)){n("_"+(r="onerror"));var o=a[r];a[r]=function(e,n,i,a,s){var c=o&&o(e,n,i,a,s);return!0!==c&&t["_"+r]({message:e,url:n,lineNumber:i,columnNumber:a,error:s}),c},e.autoExceptionInstrumented=!0}return t}(
            {
               instrumentationKey:"4f4ba091-4cff-4bd9-95e3-c5d564a1adde"
            }
            );window[aiName]=aisdk,aisdk.queue&&0===aisdk.queue.length&&aisdk.trackPageView({});
    </script>

</head>



<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Azure Readiness starts here...</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                        
                    
                    
		    
                        <li><a href="/azurehol/">Azure HOL</a></li>
                    
                        <li><a href="/books/">BOOKS</a></li>
                    
                        <li><a href="/videos/">VIDEOS</a></li>
                    
                        <li><a href="/about/">ABOUT ME</a></li>
                    

                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/img/home-bg-azure.jpg')
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/azure" title="Azure">
                            Azure
                        </a>
                        
                        <a class="tag" href="/tags/application-insights" title="Application Insights">
                            Application Insights
                        </a>
                        
                        <a class="tag" href="/tags/hugo" title="Hugo">
                            Hugo
                        </a>
                        
                    </div>
                    <h1>Collecting Hugo static site statistics using Azure Application Insights</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by 
                        
                                Azure Readiness starts here...
                         
                        on 
                        Sunday, April 26, 2020
                        
                        
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-11 col-lg-offset-1
                col-md-10 col-md-offset-1
                post-container">

                
                <header>
                    
                </header>
                
                
                <p>Welcome back!</p>
<p>About a month ago, I decided to move my former 007FFFLearning website from Wix.com to something &ldquo;easier&rdquo; to use for blog writing. While Wix is an excellent platform, offering an easy way to build a graphical website, besides a ton of plug-ins, it also comes with a cost. And since I didn&rsquo;t have a need for a lot of the built-in features I was using out of my own business before I joined Microsoft, I wanted to try something new.</p>
<p>That &ldquo;something new&rdquo; eventually was <a href="http://gohugo.io">Hugo</a>, an Open Source web platform, supporting HTML and MarkDown. After a quick test, I found it also worked fine on Azure Storage Static Site, which to me was the motivation to give it a try.</p>
<p>(FYI, have a look <a href="https://www.007ffflearning.com/post/static_site_frontdoor/">here</a> about how to get your own Hugo website started, and hosting it on Azure including Azure CDN or Azure Front Door services&hellip;)</p>
<p>Having a platform for blog posts is one thing, getting your hands on statistics around popular posts and overall web site visits is maybe even more crucial if you want to take blogging serious. Since the core backend of my <a href="http://gohugo.io">Hugo</a> site is running on Azure, I wanted to integrate <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview">Azure Application Insights</a>, since I knew how powerful it was for monitoring web application workloads, running in Azure or elsewhere.</p>
<h2 id="1-deploying-application-insights">1. Deploying Application Insights</h2>
<ul>
<li>The first step is straight forward if you already have Azure experience. From the <a href="http://portal.azure.com">Azure Portal</a>, <strong>create</strong> a new resource, and search for <strong>&ldquo;Application Insights&rdquo;</strong>.</li>
</ul>
<p><img src="../images/AppInsights_new.jpg" alt="Create Application Insights"></p>
<ul>
<li>
<p>Complete the necessary parameters to get this resource created:</p>
<ul>
<li>Subscription</li>
<li>Resource Group</li>
<li>Name</li>
<li>Azure Region</li>
</ul>
<p><img src="../images/AppInsights_create.jpg" alt="Create Application Insights"></p>
</li>
<li>
<p>Wait for the resource to get created. Once created, open the Application Insight blade:</p>
</li>
</ul>
<p><img src="../images/AppInsights_initial.jpg" alt="Create Application Insights"></p>
<h2 id="2-integrating-instrumentation-key-script-into-the-hugo-website">2. Integrating Instrumentation Key script into the Hugo website</h2>
<ul>
<li>From the top right corner, it will show you the <strong>&ldquo;Instrumentation Key&rdquo;</strong>, which is the <em>unique identifier</em> for this Application Insights instance. This must be linked to <em>each and every web page</em> we publish on our website, to transfer telemetry information back to the App Insights back-end. The way to do this is <strong>adding a little JavaScript script</strong> into the header of the <strong>index.html</strong>, and is described more in detail <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/app/website-monitoring">at the following Azure docs link</a>:</li>
</ul>
<p>While this sounds like a tremendous job, Hugo actually makes this <strong>rather easy</strong>. Although you create each standalone post (or other item) as a single MarkDown file, during the &ldquo;rendering process&rdquo;, Hugo <em>compiles this into a static index.html</em> for each post (or other item). This is based on gluing different snippets of the layout together.</p>
<p>In my Hugo theme, I found out that using the <strong>&ldquo;head.html&rdquo;</strong> file in the <strong>root of my layout folder</strong> &ldquo;(&lt;Hugo_source_folder\themes&lt;themename&gt;\layouts\partials)&rdquo; would to the trick.</p>
<p><img src="../images/AppInsights_head.jpg" alt="Create Application Insights"></p>
<ul>
<li>Open this file in a text editor like VS Code, and browse all the way to the end of the <!-- raw HTML omitted --> section. Paste in the following lines (as shown on the Azure Docs page), <strong>replacing the INSTRUMENTATION_KEY</strong> with the one you find in the Application Insights Overview section:</li>
</ul>
<pre><code>&lt;script type=&quot;text/javascript&quot;&gt;
   var sdkInstance=&quot;appInsightsSDK&quot;;window[sdkInstance]=&quot;appInsights&quot;;var aiName=window[sdkInstance],aisdk=window[aiName]||function(e){function n(e){t[e]=function(){var n=arguments;t.queue.push(function(){t[e].apply(t,n)})}}var t={config:e};t.initialize=!0;var i=document,a=window;setTimeout(function(){var n=i.createElement(&quot;script&quot;);n.src=e.url||&quot;https://az416426.vo.msecnd.net/scripts/b/ai.2.min.js&quot;,i.getElementsByTagName(&quot;script&quot;)[0].parentNode.appendChild(n)});try{t.cookie=i.cookie}catch(e){}t.queue=[],t.version=2;for(var r=[&quot;Event&quot;,&quot;PageView&quot;,&quot;Exception&quot;,&quot;Trace&quot;,&quot;DependencyData&quot;,&quot;Metric&quot;,&quot;PageViewPerformance&quot;];r.length;)n(&quot;track&quot;+r.pop());n(&quot;startTrackPage&quot;),n(&quot;stopTrackPage&quot;);var s=&quot;Track&quot;+r[0];if(n(&quot;start&quot;+s),n(&quot;stop&quot;+s),n(&quot;setAuthenticatedUserContext&quot;),n(&quot;clearAuthenticatedUserContext&quot;),n(&quot;flush&quot;),!(!0===e.disableExceptionTracking||e.extensionConfig&amp;&amp;e.extensionConfig.ApplicationInsightsAnalytics&amp;&amp;!0===e.extensionConfig.ApplicationInsightsAnalytics.disableExceptionTracking)){n(&quot;_&quot;+(r=&quot;onerror&quot;));var o=a[r];a[r]=function(e,n,i,a,s){var c=o&amp;&amp;o(e,n,i,a,s);return!0!==c&amp;&amp;t[&quot;_&quot;+r]({message:e,url:n,lineNumber:i,columnNumber:a,error:s}),c},e.autoExceptionInstrumented=!0}return t}(
   {
      instrumentationKey:&quot;INSTRUMENTATION_KEY&quot;
   }
   );window[aiName]=aisdk,aisdk.queue&amp;&amp;0===aisdk.queue.length&amp;&amp;aisdk.trackPageView({});
&lt;/script&gt;
</code></pre><ul>
<li>The code within the head.html file should look similar to this now:</li>
</ul>
<p><img src="../images/AppInsights_head_code.jpg" alt="Create Application Insights"></p>
<h2 id="3-rendercompile-your-hugo-website">3. Render/Compile your Hugo Website</h2>
<ul>
<li>
<p>From the root folder of the Hugo Website, run <strong>hugo</strong> to recompile all your content pages (posts and other) into their final index.html files.</p>
</li>
<li>
<p><strong>Publish</strong> the source code of the website to your Azure Static Site</p>
</li>
<li>
<p><strong>Browse</strong> to a few posts on your website, to <strong>generate traffic</strong>; we will validate this in the next step from within Application Insights</p>
</li>
</ul>
<h2 id="4-get-statistics-from-within-application-insights">4. Get statistics from within Application Insights</h2>
<ul>
<li>Back in <strong>Application Insights</strong> in the Azure Portal, browse to <strong>Usage</strong></li>
</ul>
<p><img src="../images/AppInsights_usagemenu.jpg" alt="Application Insights Usage"></p>
<ul>
<li>and select <strong>Users</strong>; this will show you a diagram of the user visits for the last 24 hours. You can change the time window if needed by selecting other filters.</li>
</ul>
<p><img src="../images/AppInsights_userstatistics.jpg" alt="Application Insights Users"></p>
<ul>
<li>For example, changing the time window to <strong>7 days</strong>, changes the view to this in my example:</li>
</ul>
<p><img src="../images/AppInsights_userstatistics_7days.jpg" alt="Application Insights Users_7days"></p>
<ul>
<li>If you <strong>click</strong> the <strong>&ldquo;View More Insights&rdquo;</strong> button, you can see additional statistical details about the site visitors, this time nicely structured <strong>by country</strong>:</li>
</ul>
<p><img src="../images/AppInsights_userstatistics_7days_bycountry.jpg" alt="Application Insights Users by country"></p>
<ul>
<li><strong>Scrolling more down</strong> shows yet another summary view, summarized <strong>by (active) session</strong>:</li>
</ul>
<p><img src="../images/AppInsights_userstatistics_7days_bysession.jpg" alt="Application Insights Users by session"></p>
<ul>
<li><strong>Click</strong> on any of the active session details; this opens a sidebar view, exposing more granular information about that session:</li>
</ul>
<p><img src="../images/AppInsights_session_timeline.jpg" alt="Application Insights session timeline"></p>
<ul>
<li>Back from the <strong>Usage</strong> menu of Application Insights, <strong>select</strong> <strong>Events</strong></li>
</ul>
<p><img src="../images/AppInsights_events.jpg" alt="Application Insights Events"></p>
<ul>
<li>This will again show you detailed views on the actual past events for the last 24 hours, 7 days or any other time window you select. You can again <strong>click</strong> the <strong>&ldquo;View More Insights&rdquo;</strong> button, to find specific <strong>event statistics</strong>, which refer to page views of each and every blog post on our website.</li>
</ul>
<p><img src="../images/AppInsights_eventstatistics.jpg" alt="Application Insights Event Statistics"></p>
<ul>
<li><strong>Click</strong> on any of the <strong>event statistics items</strong>; this redirects you to another section in Application Insights, the <strong>&ldquo;End-to-end transaction details&rdquo;</strong></li>
</ul>
<p><img src="../images/AppInsights_endtoend.jpg" alt="Application Insights End To End Transaction Details"></p>
<ul>
<li>From this view, select <strong>All available telemetry information for this session</strong>, under the <strong>Related items</strong> section:</li>
</ul>
<p><img src="../images/AppInsights_relateditems.jpg" alt="Application Insights Related Items"></p>
<ul>
<li>Which in turn exposes additional details about each and every item viewed during that specific session</li>
</ul>
<p><img src="../images/AppInsights_telemetry_search.jpg" alt="Application Insights Telemetry Search"></p>
<h2 id="4-summary">4. Summary</h2>
<p>Application Insights is a powerful (web) application monitoring and troubleshooting tool within Azure, coming with impressive dashboards. This allows for very detailed analytics of web sessions, users, telemetry information and more. While App Insights has a lot more features than what I covered here, it helps in getting a clear view on your Hugo website view statistics.</p>
<p>And that was the core objective of this post.</p>
<p>I&rsquo;m learning more about Hugo in combination with Azure services, and love it more each and every day. Expect more posts around these subjects in the near future.</p>
<p>For now, stay safe and healthy! as always, reach out to share your feedback or ask questions.</p>
<p>/Peter</p>


                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/static_site_frontdoor/" data-toggle="tooltip" data-placement="top" title="Running an Azure Storage Static Site, protected by Azure Front Door">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/post/use-bing-wallpaper-as-background-in-teams/" data-toggle="tooltip" data-placement="top" title="Use Bing Desktop Wallpapers as background images in Teams calls">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>

                
<div id="disqus-comment"></div>



            </div>
            
            <div class="
                col-lg-11 col-lg-offset-1
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/azure" title="azure">
                            azure
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/bing" title="bing">
                            bing
                        </a>
                        
                        
                        
                        <a href="/tags/books" title="books">
                            books
                        </a>
                        
                        
                        
                        <a href="/tags/certification" title="certification">
                            certification
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/hugo" title="hugo">
                            hugo
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/learning" title="learning">
                            learning
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    </div>
                </section>
                

                
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href='' rel="alternate" type="application/rss+xml" title="Azure Readiness starts here..." >
                           <span class="fa-stack fa-lg">
                               <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a href="mailto:info@007ffflearning.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    <li>
                        <a href="http://www.twitter.com/pdtit">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    

                    

		    
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/007ffflearning">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/pdtit/">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    
                    
            
            
            
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy; Azure Readiness starts here... 2020
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






</body>
</html>
